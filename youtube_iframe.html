<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>YouTube Player Bridge</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: black;
      }
      #player {
        width: 100%;
        height: 100%;
      }
      .youtube-container {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="youtube-container">
      <div id="player"></div>
    </div>

    <script>
      const params = new URLSearchParams(window.location.search);
      const videoId = params.get("videoId") || "";
      const disableTouch = params.get("disableTouch") || "false";
      const currentTime = parseFloat(params.get("currentTime") || "0");
      const idPlayer = params.get("idPlayer") || "player";

      if (disableTouch) {
        document.querySelector(".youtube-container").style.pointerEvents = "none";
      }

      var tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var player;
      var intervalId;

      function onYouTubeIframeAPIReady() {
        player = new YT.Player(idPlayer, {
          height: "100%",
          width: "100%",
          videoId: videoId,
          playerVars: {
            modestbranding: 1,
            rel: 0,
            playsinline: 1,
            autoplay: 1,
            controls: 0,
            origin: "https://www.youtube-nocookie.com"
          },
          events: {
            onReady: onPlayerReady,
            onStateChange: onPlayerStateChange,
          },
        });
      }

      function onPlayerReady(event) {
        event.target.seekTo(currentTime, true);
        event.target.playVideo();

        const duration = player.getDuration();
        postToReactNative({ type: "ready", duration });

        intervalId = setInterval(() => {
          const currentTime = player.getCurrentTime();
          postToReactNative({ type: "progress", currentTime });
        }, 1000);
      }

      function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
          clearInterval(intervalId);
          postToReactNative({ type: "ended" });
        }
      }

      function postToReactNative(data) {
        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(JSON.stringify(data));
        } else {
          console.log("ReactNativeWebView not found:", data);
        }
      }

      function playVideo() {
        player.playVideo();
      }
      function pauseVideo() {
        player.pauseVideo();
      }
    </script>
  </body>
</html>


